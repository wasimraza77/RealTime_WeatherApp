<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Weather+ by Wasim Raza</title>
  <meta name="description" content="Real-time weather app with animated clouds, dark mode, and modern UI. Enter any location to get live updates.">
  <!-- Favicon (inline SVG) -->
  <link rel="icon" type="image/svg+xml" href='data:image/svg+xml;utf8,
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 128 128">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#4f46e5"/>
          <stop offset="100%" stop-color="#06b6d4"/>
        </linearGradient>
      </defs>
      <rect rx="28" width="128" height="128" fill="url(%23g)"/>
      <g fill="white">
        <path d="M42 76a18 18 0 1 1 9.3-33.5A22 22 0 0 1 95 54a14 14 0 1 1 0 28H42z" opacity=".9"/>
        <rect x="58" y="26" width="12" height="36" rx="6"/>
        <rect x="46" y="38" width="36" height="12" rx="6"/>
      </g>
    </svg>' />
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root {
      --bg: #e6f3ff;
      --text: #0f172a;
      --muted: #475569;
      --card: rgba(255,255,255,0.55);
      --glass-border: rgba(255,255,255,0.4);
      --accent: #0ea5e9; /* cyan-500 */
      --accent-2: #6366f1; /* indigo-500 */
    }
    body.dark {
      --bg: #0b1220;
      --text: #e5e7eb;
      --muted: #94a3b8;
      --card: rgba(17,25,40,0.55);
      --glass-border: rgba(255,255,255,0.08);
      --accent: #22d3ee;
      --accent-2: #818cf8;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text);
      background: var(--bg);
      overflow-x: hidden;
    }

    /* Animated Clouds Background */
    .sky {
      position: fixed; inset: 0; overflow: hidden; z-index: -1;
      background: linear-gradient(180deg, rgba(14,165,233,0.18), transparent 40%),
                  radial-gradient(1000px 400px at 50% -20%, rgba(99,102,241,0.18), transparent),
                  var(--bg);
    }
    .cloud {
      position: absolute; top: var(--top, 20%);
      width: var(--w, 300px); height: var(--h, 120px);
      background: radial-gradient(circle at 25% 50%, rgba(255,255,255,0.9), rgba(255,255,255,0.7) 60%, rgba(255,255,255,0.0) 70%),
                  radial-gradient(circle at 55% 50%, rgba(255,255,255,0.9), rgba(255,255,255,0.7) 60%, rgba(255,255,255,0.0) 70%),
                  radial-gradient(circle at 75% 55%, rgba(255,255,255,0.9), rgba(255,255,255,0.7) 60%, rgba(255,255,255,0.0) 70%);
      filter: blur(1px);
      border-radius: 100px;
      opacity: var(--o, 0.7);
      animation: float var(--speed, 60s) linear infinite;
    }
    body.dark .cloud {
      background: radial-gradient(circle at 25% 50%, rgba(255,255,255,0.2), rgba(255,255,255,0.08) 60%, rgba(255,255,255,0.0) 70%),
                  radial-gradient(circle at 55% 50%, rgba(255,255,255,0.2), rgba(255,255,255,0.08) 60%, rgba(255,255,255,0.0) 70%),
                  radial-gradient(circle at 75% 55%, rgba(255,255,255,0.2), rgba(255,255,255,0.08) 60%, rgba(255,255,255,0.0) 70%);
    }
    @keyframes float {
      from { transform: translateX(-120%); }
      to   { transform: translateX(120%); }
    }

    /* App Shell */
    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 24px;
      display: grid; gap: 20px;
      grid-template-rows: auto auto 1fr;
      min-height: 100dvh;
    }
    header {
      display: flex; align-items: center; justify-content: space-between; gap: 16px;
    }
    .brand {
      display: flex; align-items: center; gap: 12px; font-weight: 800; letter-spacing: 0.2px;
      font-size: clamp(18px, 2.4vw, 24px);
    }
    .brand .logo {
      width: 36px; height: 36px; flex: 0 0 36px;
      background: conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent-2));
      border-radius: 12px; position: relative;
      box-shadow: 0 10px 30px rgba(14,165,233,.35);
    }
    .brand .logo::before { content: ""; position: absolute; inset: 6px; border-radius: 10px; background: #fff; opacity: .95; }
    .brand .logo::after  { content: "+"; position: absolute; inset: 0; display: grid; place-items: center; font-weight: 900; color: var(--accent-2); mix-blend-mode: multiply; }
    .byline { color: var(--muted); font-weight: 600; font-size: 12px; letter-spacing: .5px; }

    .controls {
      display: flex; gap: 10px; align-items: center; flex-wrap: wrap;
    }
    .toggle, .unit, .geo-btn {
      border: 1px solid var(--glass-border);
      background: var(--card);
      backdrop-filter: blur(10px);
      color: var(--text);
      border-radius: 16px;
      padding: 10px 14px; font-weight: 600;
      cursor: pointer; transition: transform .05s ease, box-shadow .2s;
      box-shadow: 0 8px 24px rgba(0,0,0,.08);
    }
    .toggle:hover, .unit:hover, .geo-btn:hover { transform: translateY(-1px); box-shadow: 0 12px 28px rgba(0,0,0,.12); }

    /* Search */
    .search {
      display: grid; grid-template-columns: 1fr auto; gap: 12px;
    }
    .search input {
      width: 100%; padding: 16px 18px; border-radius: 18px; font-size: 16px; font-weight: 600;
      border: 1px solid var(--glass-border); background: var(--card); color: var(--text);
      outline: none; box-shadow: 0 8px 24px rgba(0,0,0,.08);
    }
    .search button {
      padding: 14px 18px; border-radius: 16px; border: none; font-weight: 800; letter-spacing: .3px;
      background: linear-gradient(135deg, var(--accent), var(--accent-2)); color: white; cursor: pointer;
      box-shadow: 0 12px 30px rgba(14,165,233,.35);
    }

    /* Cards Grid */
    .grid { display: grid; gap: 16px; grid-template-columns: 1.2fr .8fr; }
    @media (max-width: 900px) { .grid { grid-template-columns: 1fr; } }

    .card {
      background: var(--card); border: 1px solid var(--glass-border); border-radius: 24px; overflow: hidden;
      box-shadow: 0 12px 32px rgba(0,0,0,.10);
    }
    .card .head { display: flex; align-items: center; justify-content: space-between; padding: 20px 22px; border-bottom: 1px solid var(--glass-border); }
    .card .content { padding: 20px 22px; }

    .current {
      display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center;
    }
    .current .big-temp { font-size: clamp(42px, 9vw, 64px); font-weight: 900; letter-spacing: -1px; line-height: 1; }
    .current .meta { color: var(--muted); font-weight: 600; }
    .current .icon img { width: 96px; height: 96px; image-rendering: -webkit-optimize-contrast; }

    .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; margin-top: 14px; }
    @media (max-width: 600px) { .stats { grid-template-columns: repeat(2, 1fr); } }
    .stat { background: rgba(255,255,255,.6); border: 1px solid var(--glass-border); border-radius: 18px; padding: 12px; font-weight: 700; }
    body.dark .stat { background: rgba(255,255,255,.04); }
    .stat small { display: block; color: var(--muted); font-weight: 600; margin-bottom: 6px; }

    .forecast {
      display: grid; grid-template-columns: repeat(5, 1fr); gap: 12px;
    }
    @media (max-width: 900px) { .forecast { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 520px) { .forecast { grid-template-columns: repeat(2, 1fr); } }

    .tile {
      background: rgba(255,255,255,.6); border: 1px solid var(--glass-border); border-radius: 18px; padding: 14px; text-align: center;
    }
    body.dark .tile { background: rgba(255,255,255,.04); }
    .tile img { width: 56px; height: 56px; }
    .tile .t { font-weight: 800; margin-top: 6px; }
    .tile small { color: var(--muted); font-weight: 600; }

    footer { color: var(--muted); font-weight: 600; text-align: center; padding: 18px 0 28px; }
    a { color: var(--accent-2); text-decoration: none; }
  </style>
</head>
<body>
  <!-- Animated Sky -->
  <div class="sky" aria-hidden="true">
    <!-- Clouds (varied speeds/opacities) -->
    <div class="cloud" style="--top:12%; --w:540px; --h:180px; --o:.55; --speed:80s;"></div>
    <div class="cloud" style="--top:22%; --w:360px; --h:140px; --o:.7; --speed:60s;"></div>
    <div class="cloud" style="--top:35%; --w:420px; --h:150px; --o:.6; --speed:90s;"></div>
    <div class="cloud" style="--top:50%; --w:520px; --h:180px; --o:.5; --speed:75s;"></div>
    <div class="cloud" style="--top:65%; --w:380px; --h:140px; --o:.6; --speed:70s;"></div>
  </div>

  <div class="container">
    <header>
      <div>
        <div class="brand"><span class="logo" aria-hidden="true"></span> Weather+ <span class="byline">by Wasim Raza</span></div>
      </div>
      <div class="controls">
        <button id="unitBtn" class="unit" title="Toggle units">°C / °F</button>
        <button id="geoBtn" class="geo-btn" title="Use my location">Use my location</button>
        <button id="modeBtn" class="toggle" title="Toggle dark mode">Dark mode</button>
      </div>
    </header>

    <form id="searchForm" class="search" autocomplete="off">
      <input id="query" name="q" placeholder="Search city, state or country… (e.g., Hyderabad, IN)" required />
      <button type="submit">Get Weather</button>
    </form>

    <main class="grid">
      <section class="card" id="currentCard">
        <div class="head">
          <div>
            <div id="location" style="font-size: clamp(18px, 2.4vw, 22px); font-weight: 800;">—</div>
            <div id="updated" class="byline">Updated —</div>
          </div>
          <div class="icon" id="currentIcon"></div>
        </div>
        <div class="content">
          <div class="current">
            <div>
              <div id="bigTemp" class="big-temp">—</div>
              <div id="desc" class="meta">—</div>
            </div>
            <div class="meta" style="text-align:right">
              <div id="range">—</div>
              <div id="feels">—</div>
            </div>
          </div>
          <div class="stats" id="stats"></div>
        </div>
      </section>

      <section class="card">
        <div class="head">
          <div style="font-weight: 800">Next 5 Days</div>
          <div class="byline">Every ~3 hours summarized</div>
        </div>
        <div class="content">
          <div class="forecast" id="forecast"></div>
        </div>
      </section>
    </main>

    <footer>
      Data by <a href="https://openweathermap.org/" target="_blank" rel="noreferrer noopener">Weather+ Servers</a>. Built for modern browsers.
    </footer>
  </div>

  <script>
    // ===== CONFIG =====
    const API_KEY = "ad2731804126c8eb09a1574755714ec0"; // <- put your key here
    const GEO_URL = "https://api.openweathermap.org/geo/1.0/direct";
    const ONECALL_URL = "https://api.openweathermap.org/data/2.5/weather"; // current
    const FORECAST_URL = "https://api.openweathermap.org/data/2.5/forecast"; // 5-day/3-hour

    // ===== Utilities =====
    const $ = (sel) => document.querySelector(sel);
    const fmtTime = (unix, tzOffset) => {
      const date = new Date((unix + tzOffset) * 1000);
      return date.toUTCString().match(/\d{2}:(\d{2}):\d{2}/) ? date.toUTCString().slice(0, 16) + " " + date.toUTCString().slice(17, 22) : date.toUTCString();
    };
    const titleCase = (s) => s.replace(/\w\S*/g, (t) => t.charAt(0).toUpperCase() + t.substr(1).toLowerCase());

    let units = localStorage.getItem('units') || 'metric'; // 'metric' or 'imperial'

    // ===== Theme handling =====
    const applyTheme = () => {
      const saved = localStorage.getItem('theme');
      const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
      const dark = saved ? saved === 'dark' : prefersDark;
      document.body.classList.toggle('dark', dark);
      $('#modeBtn').textContent = dark ? 'Light mode' : 'Dark mode';
    };
    applyTheme();

    $('#modeBtn').addEventListener('click', () => {
      const isDark = document.body.classList.toggle('dark');
      localStorage.setItem('theme', isDark ? 'dark' : 'light');
      $('#modeBtn').textContent = isDark ? 'Light mode' : 'Dark mode';
    });

    // Units toggle
    const setUnitBtn = () => $('#unitBtn').textContent = units === 'metric' ? '°C / °F' : '°F / °C';
    setUnitBtn();
    $('#unitBtn').addEventListener('click', () => {
      units = units === 'metric' ? 'imperial' : 'metric';
      localStorage.setItem('units', units);
      setUnitBtn();
      // Re-run last query if available
      const last = JSON.parse(localStorage.getItem('lastQuery') || 'null');
      if (last) fetchAndRender(last.name, last.lat, last.lon);
    });

    // ===== Search handling =====
    $('#searchForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = $('#query').value.trim();
      if (!q) return;
      try {
        const geoRes = await fetch(`${GEO_URL}?q=${encodeURIComponent(q)}&limit=1&appid=${API_KEY}`);
        if (!geoRes.ok) throw new Error('Failed to geocode');
        const geo = await geoRes.json();
        if (!geo.length) throw new Error('Location not found');
        const { name, lat, lon, state, country } = geo[0];
        const fullName = [name, state, country].filter(Boolean).join(', ');
        await fetchAndRender(fullName, lat, lon);
      } catch (err) {
        showError(err.message || 'Something went wrong');
      }
    });

    $('#geoBtn').addEventListener('click', () => {
      if (!navigator.geolocation) return showError('Geolocation is not supported');
      navigator.geolocation.getCurrentPosition(async (pos) => {
        const { latitude: lat, longitude: lon } = pos.coords;
        try {
          // Reverse geocode for a nice name
          const res = await fetch(`https://api.openweathermap.org/geo/1.0/reverse?lat=${lat}&lon=${lon}&limit=1&appid=${API_KEY}`);
          const data = await res.json();
          const { name, state, country } = data[0] || { name: 'Your Location' };
          const fullName = [name, state, country].filter(Boolean).join(', ') || 'Your Location';
          fetchAndRender(fullName, lat, lon);
        } catch (e) {
          fetchAndRender('Your Location', lat, lon);
        }
      }, (err) => showError(err.message || 'Unable to get location'));
    });

    // ===== Core fetch & render =====
    async function fetchAndRender(placeLabel, lat, lon) {
      try {
        toggleLoading(true);
        const [curRes, fcRes] = await Promise.all([
          fetch(`${ONECALL_URL}?lat=${lat}&lon=${lon}&units=${units}&appid=${API_KEY}`),
          fetch(`${FORECAST_URL}?lat=${lat}&lon=${lon}&units=${units}&appid=${API_KEY}`)
        ]);
        if (!curRes.ok || !fcRes.ok) throw new Error('API request failed');
        const current = await curRes.json();
        const forecast = await fcRes.json();
        localStorage.setItem('lastQuery', JSON.stringify({ name: placeLabel, lat, lon }));
        renderCurrent(placeLabel, current);
        renderForecast(forecast);
        $('#updated').textContent = 'Updated ' + new Date().toLocaleString();
      } catch (e) {
        showError(e.message || 'Failed to load weather');
      } finally {
        toggleLoading(false);
      }
    }

    function renderCurrent(place, data) {
      const { weather = [], main = {}, wind = {}, sys = {}, name, timezone } = data;
      const w = weather[0] || { description: '-', icon: '01d' };
      const tempUnit = units === 'metric' ? '°C' : '°F';
      const speedUnit = units === 'metric' ? 'm/s' : 'mph';

      $('#location').textContent = place || name || '—';
      $('#bigTemp').textContent = Math.round(main.temp) + tempUnit;
      $('#desc').textContent = titleCase(w.description || '-');
      $('#range').textContent = `Min/Max: ${Math.round(main.temp_min)}${tempUnit} / ${Math.round(main.temp_max)}${tempUnit}`;
      $('#feels').textContent = `Feels like ${Math.round(main.feels_like)}${tempUnit}`;

      $('#currentIcon').innerHTML = `<img alt="${w.description}" src="https://openweathermap.org/img/wn/${w.icon}@2x.png">`;

      const sunrise = sys.sunrise ? new Date(sys.sunrise * 1000) : null;
      const sunset = sys.sunset ? new Date(sys.sunset * 1000) : null;

      const stats = [
        { k: 'Humidity', v: (main.humidity ?? '-') + '%' },
        { k: 'Pressure', v: (main.pressure ?? '-') + ' hPa' },
        { k: 'Wind', v: (wind.speed != null ? wind.speed : '-') + ' ' + speedUnit },
        { k: 'Clouds', v: (data.clouds?.all ?? '-') + '%' },
        { k: 'Sunrise', v: sunrise ? sunrise.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '-' },
        { k: 'Sunset', v: sunset ? sunset.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' }) : '-' },
        { k: 'Visibility', v: data.visibility != null ? Math.round(data.visibility / 1000) + ' km' : '-' },
        { k: 'Coord', v: `${data.coord?.lat?.toFixed(2) ?? '-'}, ${data.coord?.lon?.toFixed(2) ?? '-'}` }
      ];

      const statsEl = $('#stats');
      statsEl.innerHTML = '';
      stats.forEach(s => {
        const el = document.createElement('div');
        el.className = 'stat';
        el.innerHTML = `<small>${s.k}</small>${s.v}`;
        statsEl.appendChild(el);
      });
    }

    function renderForecast(data) {
      // Group by day and show midday snapshot (12:00) when available
      const byDay = {};
      (data.list || []).forEach(item => {
        const dt = new Date(item.dt * 1000);
        const day = dt.toISOString().slice(0,10);
        const hour = dt.getUTCHours();
        if (!byDay[day]) byDay[day] = [];
        byDay[day].push(item);
      });
      const days = Object.keys(byDay).slice(0,5);
      const container = $('#forecast');
      container.innerHTML = '';
      days.forEach(day => {
        const items = byDay[day];
        // pick entry closest to 12:00 local approximation by picking index ~4 (since 3h steps)
        const pick = items[Math.min(4, items.length-1)];
        const temp = Math.round(pick.main.temp);
        const min = Math.round(Math.min(...items.map(i => i.main.temp_min)));
        const max = Math.round(Math.max(...items.map(i => i.main.temp_max)));
        const icon = pick.weather?.[0]?.icon || '01d';
        const desc = pick.weather?.[0]?.description || '';
        const date = new Date(day);
        const label = date.toLocaleDateString(undefined, { weekday: 'short', day: 'numeric' });
        const t = document.createElement('div');
        t.className = 'tile';
        t.innerHTML = `
          <div><strong>${label}</strong></div>
          <img alt="${desc}" src="https://openweathermap.org/img/wn/${icon}@2x.png"/>
          <div class="t">${temp}${units === 'metric' ? '°C' : '°F'}</div>
          <small>${titleCase(desc)}</small>
          <small>Min/Max: ${min} / ${max}</small>
        `;
        container.appendChild(t);
      });
    }

    function toggleLoading(isLoading) {
      const btn = document.querySelector('.search button');
      btn.disabled = isLoading;
      btn.textContent = isLoading ? 'Loading…' : 'Get Weather';
    }

    function showError(msg) {
      $('#updated').textContent = msg;
    }

    // Auto-load last query if present
    (function init() {
      const last = JSON.parse(localStorage.getItem('lastQuery') || 'null');
      if (last) fetchAndRender(last.name, last.lat, last.lon);
      else {
        // Try a pleasant default
        $('#query').value = 'Hyderabad, IN';
      }
    })();

    // Optional: refresh every 10 minutes when app is open
    setInterval(() => {
      const last = JSON.parse(localStorage.getItem('lastQuery') || 'null');
      if (last) fetchAndRender(last.name, last.lat, last.lon);
    }, 10 * 60 * 1000);
    
  </script>
</body>
</html>
